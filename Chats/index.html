<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LA EXCELENCIA - Chat Seguro</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary: #00C851;
        --primary-dark: #009624;
        --accent: #00ff88;
        --dark: #0a1929;
        --darker: #051423;
        --light: #ffffff;
        --gray-light: #1e2a3a;
        --gray: #8b9cb1;
        --gray-dark: #6c757d;
        --card-bg: #15202b;
        --border: #2d3e50;
        --text-light: #ffffff;
        --text-gray: #8b9cb1;
        --transition: all 0.3s ease;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.4);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Montserrat', sans-serif;
    }
    
    body {
        background: var(--darker);
        color: var(--text-light);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
    }
    
    /* PANTALLA DE LOGIN */
    .login-screen {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
    }
    
    .login-container {
        background: var(--dark);
        border-radius: 15px;
        padding: 40px 30px;
        width: 100%;
        max-width: 400px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border);
    }
    
    .logo-section {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .logo-section img {
        height: 80px;
        width: auto;
        border-radius: 10px;
        margin-bottom: 15px;
    }
    
    .logo-section h1 {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-light);
        margin-bottom: 5px;
    }
    
    .logo-section p {
        color: var(--text-gray);
        font-size: 0.9rem;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-light);
        font-size: 0.9rem;
    }
    
    .form-input {
        width: 100%;
        padding: 15px;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--text-light);
        font-size: 1rem;
        transition: var(--transition);
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(0, 200, 81, 0.2);
    }
    
    .form-input::placeholder {
        color: var(--text-gray);
    }
    
    .btn {
        width: 100%;
        padding: 15px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 15px;
    }
    
    .btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .divider {
        text-align: center;
        margin: 25px 0;
        position: relative;
        color: var(--text-gray);
        font-size: 0.9rem;
    }
    
    .divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--border);
        z-index: 1;
    }
    
    .divider span {
        background: var(--dark);
        padding: 0 15px;
        position: relative;
        z-index: 2;
    }
    
    .switch-form {
        text-align: center;
        margin-top: 20px;
        color: var(--text-gray);
        font-size: 0.9rem;
    }
    
    .switch-form a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
    }
    
    .switch-form a:hover {
        text-decoration: underline;
    }
    
    .error-message {
        background: rgba(220, 53, 69, 0.1);
        border: 1px solid rgba(220, 53, 69, 0.3);
        color: #ff6b6b;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.9rem;
        text-align: center;
        display: none;
    }
    
    .success-message {
        background: rgba(0, 200, 81, 0.1);
        border: 1px solid rgba(0, 200, 81, 0.3);
        color: var(--primary);
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.9rem;
        text-align: center;
        display: none;
    }
    
    /* PANTALLA DEL CHAT */
    .chat-screen {
        display: none;
        min-height: 100vh;
        flex-direction: column;
    }
    
    /* Header */
    .app-header {
        background: var(--dark);
        color: var(--text-light);
        padding: 15px 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
        border-bottom: 1px solid var(--border);
    }
    
    .header-content {
        max-width: 100%;
        margin: 0 auto;
        padding: 0 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo {
        font-size: 1.4rem;
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text-light);
    }
    
    .logo img {
        height: 32px;
        width: auto;
        border-radius: 6px;
    }
    
    .header-actions {
        display: flex;
        gap: 15px;
    }
    
    .header-btn {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        padding: 8px;
        border-radius: 50%;
    }
    
    .header-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    /* Search Bar */
    .search-container {
        padding: 10px 15px;
        background: var(--dark);
        border-bottom: 1px solid var(--border);
    }
    
    .search-box {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .search-box i {
        color: var(--text-gray);
    }
    
    .search-input {
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 0.9rem;
        width: 100%;
        outline: none;
    }
    
    .search-input::placeholder {
        color: var(--text-gray);
    }
    
    /* Main Container */
    .app-container {
        max-width: 100%;
        margin: 0 auto;
        flex: 1;
        background: var(--darker);
        padding-bottom: 70px;
    }
    
    /* Content Sections */
    .content-section {
        display: none;
        animation: fadeIn 0.3s ease;
        background: var(--darker);
    }
    
    .content-section.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Chat List */
    .chat-list {
        background: var(--darker);
    }
    
    .chat-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .chat-item:last-child {
        border-bottom: none;
    }
    
    .chat-item:hover {
        background: var(--dark);
    }
    
    .chat-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--primary);
        border: 2px solid var(--card-bg);
    }
    
    .chat-info {
        flex: 1;
        min-width: 0;
    }
    
    .chat-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .last-message {
        font-size: 0.85rem;
        color: var(--text-gray);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .chat-meta {
        text-align: right;
    }
    
    .message-time {
        font-size: 0.75rem;
        color: var(--text-gray);
        margin-bottom: 4px;
    }
    
    .unread-badge {
        background: var(--primary);
        color: white;
        border-radius: 10px;
        padding: 2px 8px;
        font-size: 0.7rem;
        font-weight: bold;
    }
    
    /* Contact List */
    .contact-list {
        background: var(--darker);
    }
    
    .contact-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .contact-item:last-child {
        border-bottom: none;
    }
    
    .contact-item:hover {
        background: var(--dark);
    }
    
    .contact-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.1rem;
        position: relative;
    }
    
    .contact-info {
        flex: 1;
    }
    
    .contact-name {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .contact-status {
        font-size: 0.85rem;
        color: var(--text-gray);
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    /* Status Section */
    .status-section {
        background: var(--darker);
        padding: 15px;
    }
    
    .my-status {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 15px;
        cursor: pointer;
    }
    
    .my-status:hover {
        background: var(--dark);
        margin: -10px -15px;
        padding: 10px 15px;
        border-radius: 8px;
    }
    
    .status-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.3rem;
        border: 3px solid var(--primary);
    }
    
    .status-info h3 {
        font-size: 1rem;
        margin-bottom: 5px;
        color: var(--text-light);
    }
    
    .status-info p {
        font-size: 0.85rem;
        color: var(--text-gray);
    }
    
    .recent-updates {
        margin-top: 15px;
    }
    
    .recent-updates h3 {
        font-size: 1rem;
        margin-bottom: 10px;
        color: var(--text-light);
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
    }
    
    .status-item:last-child {
        border-bottom: none;
    }
    
    .status-item:hover {
        background: var(--dark);
        margin: -10px -15px;
        padding: 10px 15px;
        border-radius: 8px;
    }
    
    .status-avatar-small {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1rem;
        border: 2px solid var(--primary);
    }
    
    .status-content {
        flex: 1;
    }
    
    .status-user {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 4px;
        color: var(--text-light);
    }
    
    .status-text {
        font-size: 0.85rem;
        color: var(--text-gray);
    }
    
    .status-time {
        font-size: 0.75rem;
        color: var(--text-gray);
    }
    
    /* Chat View */
    .chat-view {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--darker);
        z-index: 1000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
    }
    
    .chat-view.active {
        transform: translateX(0);
    }
    
    .chat-header {
        background: var(--dark);
        color: var(--text-light);
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: var(--shadow);
        border-bottom: 1px solid var(--border);
    }
    
    .back-button {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 1.3rem;
        cursor: pointer;
        padding: 5px;
    }
    
    .chat-header-info {
        flex: 1;
    }
    
    .chat-header-info h3 {
        font-size: 1.1rem;
        margin-bottom: 2px;
        color: var(--text-light);
    }
    
    .chat-header-info p {
        font-size: 0.8rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 5px;
        color: var(--text-gray);
    }
    
    .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: var(--darker);
    }
    
    .message {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        position: relative;
        animation: messageAppear 0.3s ease;
        word-wrap: break-word;
    }
    
    @keyframes messageAppear {
        0% { opacity: 0; transform: translateY(10px) scale(0.95); }
        100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .message.sent {
        align-self: flex-end;
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .message.received {
        align-self: flex-start;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-bottom-left-radius: 4px;
        color: var(--text-light);
    }
    
    .message-content {
        word-break: break-word;
        line-height: 1.4;
        font-size: 0.95rem;
    }
    
    .message-time {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 5px;
        text-align: right;
        color: rgba(255, 255, 255, 0.6);
    }
    
    .message-input-container {
        padding: 15px;
        background: var(--dark);
        border-top: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .message-input-wrapper {
        flex: 1;
        background: var(--card-bg);
        border-radius: 25px;
        padding: 8px 15px;
        display: flex;
        align-items: center;
        min-height: 45px;
        border: 1px solid var(--border);
    }
    
    .message-input {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-light);
        font-size: 0.95rem;
        padding: 5px 0;
        resize: none;
        height: auto;
        min-height: 25px;
        max-height: 100px;
        outline: none;
        line-height: 1.4;
    }
    
    .message-input::placeholder {
        color: var(--text-gray);
    }
    
    .attach-btn, .emoji-btn {
        background: none;
        border: none;
        color: var(--text-gray);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .send-button {
        background: var(--primary);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        transition: var(--transition);
    }
    
    .send-button:active {
        transform: scale(0.95);
    }
    
    /* Bottom Navigation */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--dark);
        border-top: 1px solid var(--border);
        display: flex;
        padding: 8px 0;
        z-index: 100;
    }
    
    .nav-item {
        flex: 1;
        text-align: center;
        padding: 8px 0;
        color: var(--text-gray);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        background: none;
        font-size: 0.75rem;
    }
    
    .nav-item.active {
        color: var(--primary);
    }
    
    .nav-item i {
        display: block;
        font-size: 1.3rem;
        margin-bottom: 4px;
    }
    
    /* Settings Menu */
    .settings-menu {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: var(--dark);
        z-index: 1100;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
        overflow-y: auto;
    }
    
    .settings-menu.active {
        right: 0;
    }
    
    .settings-header {
        background: var(--card-bg);
        padding: 20px;
        border-bottom: 1px solid var(--border);
    }
    
    .settings-header h2 {
        font-size: 1.3rem;
        margin-bottom: 5px;
    }
    
    .settings-items {
        padding: 10px 0;
    }
    
    .settings-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        cursor: pointer;
        transition: var(--transition);
    }
    
    .settings-item:last-child {
        border-bottom: none;
    }
    
    .settings-item:hover {
        background: var(--card-bg);
    }
    
    .settings-item i {
        font-size: 1.2rem;
        color: var(--primary);
        width: 24px;
        text-align: center;
    }
    
    /* Profile Section */
    .profile-section {
        padding: 20px;
        background: var(--card-bg);
        margin: 15px;
        border-radius: 12px;
        text-align: center;
    }
    
    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 2rem;
        margin: 0 auto 15px;
        border: 4px solid var(--primary);
    }
    
    .profile-name {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 5px;
    }
    
    .profile-email {
        color: var(--text-gray);
        font-size: 0.9rem;
    }
    
    /* Overlay */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1050;
        display: none;
    }
    
    .overlay.active {
        display: block;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
        .app-container {
            min-height: calc(100vh - 140px);
        }
        
        .chat-item, .contact-item, .status-item {
            padding: 12px 15px;
        }
        
        .chat-avatar, .contact-avatar {
            width: 45px;
            height: 45px;
            font-size: 1rem;
        }
        
        .message {
            max-width: 85%;
        }
        
        .message-input-container {
            padding: 10px 15px;
            gap: 8px;
        }
        
        .attach-btn, .emoji-btn, .send-button {
            width: 36px;
            height: 36px;
            font-size: 1.1rem;
        }
        
        .nav-item {
            font-size: 0.7rem;
        }
        
        .nav-item i {
            font-size: 1.2rem;
        }
    }
    
    @media (min-width: 768px) {
        .app-container {
            max-width: 500px;
            margin: 0 auto;
            box-shadow: var(--shadow-lg);
            min-height: 100vh;
        }
        
        .bottom-nav {
            max-width: 500px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .settings-menu {
            width: 350px;
        }
    }
    </style>
</head>
<body>
    <!-- PANTALLA DE LOGIN/REGISTRO -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="logo-section">
                
                <h1>LA EXCELENCIA</h1>
                <p>Comunicación segura para clientes de la excelencia</p>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <!-- Formulario de Login -->
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="loginEmail">Correo electrónico</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="tu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Contraseña</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
            </form>
            
            <div class="divider"><span>o</span></div>
            
            <!-- Formulario de Registro -->
            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="registerName">Nombre completo</label>
                    <input type="text" class="form-input" id="registerName" placeholder="Tu nombre" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerEmail">Correo electrónico</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="tu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerPassword">Contraseña</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="••••••••" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerConfirmPassword">Confirmar contraseña</label>
                    <input type="password" class="form-input" id="registerConfirmPassword" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="btn" id="registerBtn">
                    <i class="fas fa-user-plus"></i> Crear Cuenta
                </button>
            </form>
            
            <div class="switch-form">
                <span id="switchText">¿No tienes cuenta?</span>
                <a id="switchLink">Regístrate aquí</a>
            </div>
        </div>
    </div>

    <!-- PANTALLA DEL CHAT -->
    <div class="chat-screen" id="chatScreen">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <img src="https://raw.githubusercontent.com/welding30001994/Jayden_control/refs/heads/main/jayden.jpeg" alt="Jayden Chat">
                    <span>LA EXCELENCIA </span>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="searchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="header-btn" id="menuBtn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Search Bar -->
        <div class="search-container" id="searchContainer" style="display: none;">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar contactos...">
            </div>
        </div>

        <!-- Main Content -->
        <main class="app-container">
            <!-- Chats Section -->
            <section id="chats" class="content-section active">
                <div class="chat-list" id="chatsList">
                    <!-- Los chats se cargarán aquí dinámicamente -->
                </div>
            </section>

            <!-- Contacts Section -->
            <section id="contacts" class="content-section">
                <div class="contact-list" id="contactsList">
                    <!-- Los contactos se cargarán aquí dinámicamente -->
                </div>
            </section>

            <!-- Status Section -->
            <section id="status" class="content-section">
                <div class="status-section">
                    <div class="my-status">
                        <div class="status-avatar" id="myStatusAvatar">U</div>
                        <div class="status-info">
                            <h3 id="myStatusName">Mi estado</h3>
                            <p>Toca para agregar una actualización</p>
                        </div>
                    </div>
                    
                    <div class="recent-updates">
                        <h3>Actualizaciones recientes</h3>
                        <div id="statusUpdates">
                            <!-- Los estados se cargarán aquí dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Chat View (Oculto por defecto) -->
        <div class="chat-view" id="chatView">
            <div class="chat-header">
                <button class="back-button" id="backFromChat">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="chat-avatar" id="chatHeaderAvatar">
                    <div class="online-indicator" id="chatHeaderOnline"></div>
                </div>
                <div class="chat-header-info">
                    <h3 id="chatWithName">Usuario</h3>
                    <p id="chatHeaderStatus"><i class="fas fa-circle"></i> En línea</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Los mensajes se cargarán aquí dinámicamente -->
            </div>
            
            <div class="message-input-container">
                <button class="attach-btn">
                    <i class="fas fa-paperclip"></i>
                </button>
                <div class="message-input-wrapper">
                    <textarea class="message-input" id="messageInput" placeholder="Escribe un mensaje..." rows="1"></textarea>
                </div>
                <button class="emoji-btn">
                    <i class="far fa-smile"></i>
                </button>
                <button class="send-button" id="sendMessageBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Settings Menu -->
        <div class="settings-menu" id="settingsMenu">
            <div class="settings-header">
                <h2>Ajustes</h2>
                <p>Configura tu cuenta y preferencias</p>
            </div>
            
            <div class="profile-section">
                <div class="profile-avatar" id="profileAvatar">U</div>
                <div class="profile-name" id="profileName">Usuario</div>
                <div class="profile-email" id="profileEmail">usuario@ejemplo.com</div>
            </div>
            
            <div class="settings-items">
                <div class="settings-item" id="editProfileBtn">
                    <i class="fas fa-user-edit"></i>
                    <span>Editar perfil</span>
                </div>
                <div class="settings-item" id="newGroupBtn">
                    <i class="fas fa-users"></i>
                    <span>Nuevo grupo</span>
                </div>
                <div class="settings-item" id="linkedDevicesBtn">
                    <i class="fas fa-link"></i>
                    <span>Dispositivos vinculados</span>
                </div>
                <div class="settings-item" id="privacyBtn">
                    <i class="fas fa-lock"></i>
                    <span>Privacidad y seguridad</span>
                </div>
                <div class="settings-item" id="themeBtn">
                    <i class="fas fa-palette"></i>
                    <span>Tema (Claro/Oscuro)</span>
                </div>
                <div class="settings-item" id="blockedUsersBtn">
                    <i class="fas fa-ban"></i>
                    <span>Usuarios bloqueados</span>
                </div>
                <div class="settings-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar sesión</span>
                </div>
            </div>
        </div>

        <!-- Overlay -->
        <div class="overlay" id="overlay"></div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-tab="chats">
                <i class="fas fa-comments"></i>
                <span>Chats</span>
            </button>
            <button class="nav-item" data-tab="contacts">
                <i class="fas fa-users"></i>
                <span>Contactos</span>
            </button>
            <button class="nav-item" data-tab="status">
                <i class="fas fa-circle"></i>
                <span>Estados</span>
            </button>
        </nav>
    </div>

    <script>
        // Inicializar Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB1Cs2os3tTfrMbYSAmDeJAGnP4tTtsFdw",
            authDomain: "beaver-trading.firebaseapp.com",
            databaseURL: "https://beaver-trading-default-rtdb.firebaseio.com",
            projectId: "beaver-trading",
            storageBucket: "beaver-trading.firebasestorage.app",
            messagingSenderId: "926610131904",
            appId: "1:926610131904:web:c147bd337bd12b4d085625",
            measurementId: "G-1K51WWF2ZJ"
        };
        
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Variables globales
        let currentUser = null;
        let selectedUser = null;
        let usersRef = null;
        let messagesRef = null;
        let statusRef = null;
        let filteredContacts = [];
        
        // Elementos del DOM
        const loginScreen = document.getElementById('loginScreen');
        const chatScreen = document.getElementById('chatScreen');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const switchText = document.getElementById('switchText');
        const switchLink = document.getElementById('switchLink');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        
        // Elementos del chat
        const chatsList = document.getElementById('chatsList');
        const contactsList = document.getElementById('contactsList');
        const statusUpdates = document.getElementById('statusUpdates');
        const chatView = document.getElementById('chatView');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const backFromChat = document.getElementById('backFromChat');
        const myStatusAvatar = document.getElementById('myStatusAvatar');
        const myStatusName = document.getElementById('myStatusName');
        const chatHeaderAvatar = document.getElementById('chatHeaderAvatar');
        const chatHeaderOnline = document.getElementById('chatHeaderOnline');
        const chatHeaderStatus = document.getElementById('chatHeaderStatus');
        const searchContainer = document.getElementById('searchContainer');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const menuBtn = document.getElementById('menuBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const overlay = document.getElementById('overlay');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        
        // Navegación
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        
        // Verificar autenticación al cargar la página
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Usuario autenticado - mostrar chat
                currentUser = user;
                showChatScreen();
                setupUser(user);
                loadUsers();
                loadChats();
                loadStatusUpdates();
                setupPresence();
                updateProfileInfo();
            } else {
                // Usuario no autenticado - mostrar login
                showLoginScreen();
            }
        });
        
        // Mostrar pantalla de login
        function showLoginScreen() {
            loginScreen.style.display = 'flex';
            chatScreen.style.display = 'none';
        }
        
        // Mostrar pantalla de chat
        function showChatScreen() {
            loginScreen.style.display = 'none';
            chatScreen.style.display = 'flex';
        }
        
        // Cambiar entre login y registro
        let isLogin = true;
        
        switchLink.addEventListener('click', function() {
            isLogin = !isLogin;
            
            if (isLogin) {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                switchText.textContent = '¿No tienes cuenta?';
                switchLink.textContent = 'Regístrate aquí';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                switchText.textContent = '¿Ya tienes cuenta?';
                switchLink.textContent = 'Inicia sesión aquí';
            }
            
            hideMessages();
        });
        
        // Mostrar mensaje de error
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }
        
        // Mostrar mensaje de éxito
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
        }
        
        // Ocultar mensajes
        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }
        
        // Login
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Éxito - la redirección se maneja en onAuthStateChanged
                    showSuccess('Inicio de sesión exitoso!');
                })
                .catch((error) => {
                    let errorMsg = 'Error al iniciar sesión. ';
                    
                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMsg += 'El correo electrónico no es válido.';
                            break;
                        case 'auth/user-disabled':
                            errorMsg += 'Esta cuenta ha sido deshabilitada.';
                            break;
                        case 'auth/user-not-found':
                            errorMsg += 'No existe una cuenta con este correo.';
                            break;
                        case 'auth/wrong-password':
                            errorMsg += 'La contraseña es incorrecta.';
                            break;
                        default:
                            errorMsg += error.message;
                    }
                    
                    showError(errorMsg);
                });
        });
        
        // Registro
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            // Validaciones
            if (password !== confirmPassword) {
                showError('Las contraseñas no coinciden.');
                return;
            }
            
            if (password.length < 6) {
                showError('La contraseña debe tener al menos 6 caracteres.');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Guardar información adicional del usuario en la base de datos
                    return database.ref('users/' + user.uid).set({
                        name: name,
                        email: email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                })
                .then(() => {
                    showSuccess('¡Cuenta creada exitosamente!');
                    // La redirección se maneja automáticamente en onAuthStateChanged
                })
                .catch((error) => {
                    let errorMsg = 'Error al crear la cuenta. ';
                    
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMsg += 'Ya existe una cuenta con este correo.';
                            break;
                        case 'auth/invalid-email':
                            errorMsg += 'El correo electrónico no es válido.';
                            break;
                        case 'auth/weak-password':
                            errorMsg += 'La contraseña es demasiado débil.';
                            break;
                        default:
                            errorMsg += error.message;
                    }
                    
                    showError(errorMsg);
                });
        });
        
        // Configurar usuario
        function setupUser(user) {
            database.ref('users/' + user.uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    myStatusName.textContent = userData.name || 'Mi estado';
                    myStatusAvatar.textContent = (userData.name || 'U').charAt(0).toUpperCase();
                } else {
                    const displayName = user.email.split('@')[0];
                    myStatusName.textContent = 'Mi estado';
                    myStatusAvatar.textContent = displayName.charAt(0).toUpperCase();
                    
                    database.ref('users/' + user.uid).set({
                        name: displayName,
                        email: user.email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            });
        }
        
        // Actualizar información del perfil
        function updateProfileInfo() {
            if (currentUser) {
                database.ref('users/' + currentUser.uid).once('value').then((snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        profileName.textContent = userData.name || 'Usuario';
                        profileEmail.textContent = userData.email || currentUser.email;
                        profileAvatar.textContent = (userData.name || 'U').charAt(0).toUpperCase();
                    }
                });
            }
        }
        
        // Cargar usuarios para contactos
        function loadUsers() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                contactsList.innerHTML = '';
                const users = snapshot.val();
                filteredContacts = [];
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            filteredContacts.push({ userId, ...user });
                            createContactItem(userId, user);
                        }
                    });
                }
                
                if (filteredContacts.length === 0) {
                    contactsList.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                            <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay contactos disponibles</p>
                            <p style="font-size: 0.8rem; margin-top: 10px;">Los usuarios que se registren aparecerán aquí</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de contacto
        function createContactItem(userId, user) {
            const contactItem = document.createElement('div');
            contactItem.className = 'contact-item';
            contactItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            contactItem.innerHTML = `
                <div class="contact-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="contactOnline-${userId}"></div>
                </div>
                <div class="contact-info">
                    <div class="contact-name">${user.name || 'Usuario'}</div>
                    <div class="contact-status" id="contactStatus-${userId}">
                        <i class="fas fa-circle"></i> En línea
                    </div>
                </div>
            `;
            
            contactItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            contactsList.appendChild(contactItem);
            checkUserOnlineStatus(userId);
        }
        
        // Cargar chats
        function loadChats() {
            usersRef = database.ref('users');
            
            usersRef.on('value', (snapshot) => {
                chatsList.innerHTML = '';
                const users = snapshot.val();
                
                if (users) {
                    Object.keys(users).forEach((userId) => {
                        if (userId !== currentUser.uid) {
                            const user = users[userId];
                            createChatItem(userId, user);
                        }
                    });
                }
                
                if (chatsList.children.length === 0) {
                    chatsList.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                            <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>No hay conversaciones</p>
                            <p style="font-size: 0.8rem; margin-top: 10px;">Inicia una conversación con tus contactos</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de chat
        function createChatItem(userId, user) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.dataset.userId = userId;
            
            const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            chatItem.innerHTML = `
                <div class="chat-avatar">
                    ${avatarText}
                    <div class="online-indicator" id="chatOnline-${userId}"></div>
                </div>
                <div class="chat-info">
                    <div class="chat-name">${user.name || 'Usuario'}</div>
                    <div class="last-message" id="lastMessage-${userId}">Haz clic para chatear</div>
                </div>
                <div class="chat-meta">
                    <div class="message-time" id="lastMessageTime-${userId}"></div>
                    <div class="unread-badge" id="unreadBadge-${userId}" style="display: none;">1</div>
                </div>
            `;
            
            chatItem.addEventListener('click', () => {
                openChat(userId, user);
            });
            
            chatsList.appendChild(chatItem);
            checkUserOnlineStatus(userId);
            loadLastMessage(userId);
        }
        
        // Cargar últimos mensajes
        function loadLastMessage(userId) {
            const chatId = getChatId(currentUser.uid, userId);
            const lastMessageRef = database.ref('chats/' + chatId).orderByKey().limitToLast(1);
            
            lastMessageRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                const lastMessageElement = document.getElementById(`lastMessage-${userId}`);
                const lastMessageTimeElement = document.getElementById(`lastMessageTime-${userId}`);
                
                if (message) {
                    let messageText = message.text || '';
                    
                    if (lastMessageElement) {
                        lastMessageElement.textContent = messageText.substring(0, 30) + (messageText.length > 30 ? '...' : '');
                    }
                    
                    if (lastMessageTimeElement) {
                        const time = new Date(message.timestamp);
                        lastMessageTimeElement.textContent = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    }
                }
            });
        }
        
        // Cargar estados
        function loadStatusUpdates() {
            statusRef = database.ref('status_updates').orderByChild('timestamp').limitToLast(10);
            
            statusRef.on('value', (snapshot) => {
                statusUpdates.innerHTML = '';
                const updates = snapshot.val();
                
                if (updates) {
                    Object.keys(updates).forEach((updateId) => {
                        const update = updates[updateId];
                        createStatusItem(updateId, update);
                    });
                }
                
                if (statusUpdates.children.length === 0) {
                    statusUpdates.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-gray);">
                            <p>No hay actualizaciones recientes</p>
                        </div>
                    `;
                }
            });
        }
        
        // Crear elemento de estado
        function createStatusItem(updateId, update) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            
            // Obtener información del usuario
            database.ref('users/' + update.userId).once('value').then((userSnapshot) => {
                const user = userSnapshot.val();
                const avatarText = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                
                statusItem.innerHTML = `
                    <div class="status-avatar-small">
                        ${avatarText}
                    </div>
                    <div class="status-content">
                        <div class="status-user">${user.name || 'Usuario'}</div>
                        <div class="status-text">${update.text || '📷 Imagen'}</div>
                    </div>
                    <div class="status-time">${formatTime(update.timestamp)}</div>
                `;
                
                statusUpdates.appendChild(statusItem);
            });
        }
        
        // Verificar estado en línea
        function checkUserOnlineStatus(userId) {
            const userStatusRef = database.ref('status/' + userId);
            
            userStatusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                const chatOnline = document.getElementById(`chatOnline-${userId}`);
                const contactOnline = document.getElementById(`contactOnline-${userId}`);
                const contactStatus = document.getElementById(`contactStatus-${userId}`);
                
                if (status && status.state === 'online') {
                    if (chatOnline) chatOnline.style.display = 'block';
                    if (contactOnline) contactOnline.style.display = 'block';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle"></i> En línea';
                } else {
                    if (chatOnline) chatOnline.style.display = 'none';
                    if (contactOnline) contactOnline.style.display = 'none';
                    if (contactStatus) contactStatus.innerHTML = '<i class="fas fa-circle" style="color: #666"></i> Desconectado';
                }
            });
        }
        
        // Configurar presencia
        function setupPresence() {
            const userStatusRef = database.ref('status/' + currentUser.uid);
            
            userStatusRef.set({
                state: 'online',
                lastChanged: firebase.database.ServerValue.TIMESTAMP
            });
            
            window.addEventListener('beforeunload', () => {
                userStatusRef.set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            });
        }
        
        // Abrir chat
        function openChat(userId, user) {
            selectedUser = { id: userId, ...user };
            
            document.getElementById('chatWithName').textContent = user.name || 'Usuario';
            chatHeaderAvatar.textContent = user.name ? user.name.charAt(0).toUpperCase() : 'U';
            
            // Actualizar estado en tiempo real en el header del chat
            checkUserOnlineStatusForChat(userId);
            
            chatView.classList.add('active');
            loadChatMessages(userId);
        }
        
        // Verificar estado para el chat abierto
        function checkUserOnlineStatusForChat(userId) {
            const userStatusRef = database.ref('status/' + userId);
            
            userStatusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                
                if (status && status.state === 'online') {
                    chatHeaderOnline.style.display = 'block';
                    chatHeaderStatus.innerHTML = '<i class="fas fa-circle"></i> En línea';
                } else {
                    chatHeaderOnline.style.display = 'none';
                    chatHeaderStatus.innerHTML = '<i class="fas fa-circle" style="color: #666"></i> Desconectado';
                }
            });
        }
        
        // Cargar mensajes del chat
        function loadChatMessages(userId) {
            chatMessages.innerHTML = '';
            
            const chatId = getChatId(currentUser.uid, userId);
            messagesRef = database.ref('chats/' + chatId);
            
            messagesRef.on('child_added', (snapshot) => {
                const message = snapshot.val();
                displayMessage(message);
            });
        }
        
        // Mostrar mensaje en el chat
        function displayMessage(message) {
            const messageElement = document.createElement('div');
            
            const isSent = message.senderId === currentUser.uid;
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            
            // Mostrar mensaje sin cifrado en la interfaz
            const messageText = message.text || '';
            
            const time = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                <div class="message-content">${messageText}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Enviar mensaje
        function sendMessage() {
            const text = messageInput.value.trim();
            
            if (text && selectedUser) {
                const chatId = getChatId(currentUser.uid, selectedUser.id);
                const messageRef = database.ref('chats/' + chatId).push();
                const messageId = messageRef.key;
                
                // Guardar mensaje SIN cifrado en la base de datos
                messageRef.set({
                    text: text, // Sin cifrado
                    senderId: currentUser.uid,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    messageId: messageId
                });
                
                messageInput.value = '';
                adjustTextareaHeight();
            }
        }
        
        // ID único para chat
        function getChatId(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }
        
        // Formatear tiempo
        function formatTime(timestamp) {
            const time = new Date(timestamp);
            const now = new Date();
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Ahora';
            if (diffMins < 60) return `${diffMins}m`;
            return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Ajustar altura del textarea
        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 100) + 'px';
        }
        
        // Filtrar contactos
        function filterContacts(searchTerm) {
            const filtered = filteredContacts.filter(contact => 
                contact.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            contactsList.innerHTML = '';
            
            if (filtered.length === 0) {
                contactsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-gray);">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No se encontraron contactos</p>
                    </div>
                `;
            } else {
                filtered.forEach(contact => {
                    createContactItem(contact.userId, contact);
                });
            }
        }

        // Función para cerrar sesión
        function logout() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
            
            auth.signOut().then(() => {
                // Al cerrar sesión, se mostrará automáticamente la pantalla de login
                // gracias al listener onAuthStateChanged
            }).catch(error => {
                console.error('Error al cerrar sesión:', error);
            });
        }

        // Event Listeners para el chat
        document.addEventListener('DOMContentLoaded', function() {
            // Navegación inferior
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar navegación inferior
                    navItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar sección correspondiente
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === tabId) {
                            section.classList.add('active');
                        }
                    });
                });
            });

            // Envío de mensajes
            sendMessageBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Ajustar altura del textarea dinámicamente
            messageInput.addEventListener('input', adjustTextareaHeight);

            // Volver del chat
            backFromChat.addEventListener('click', function() {
                chatView.classList.remove('active');
                if (messagesRef) {
                    messagesRef.off();
                }
            });

            // Búsqueda
            searchBtn.addEventListener('click', function() {
                searchContainer.style.display = searchContainer.style.display === 'none' ? 'block' : 'none';
                if (searchContainer.style.display === 'block') {
                    searchInput.focus();
                }
            });

            searchInput.addEventListener('input', function() {
                filterContacts(this.value);
            });

            // Menú de ajustes
            menuBtn.addEventListener('click', function() {
                settingsMenu.classList.add('active');
                overlay.classList.add('active');
            });

            overlay.addEventListener('click', function() {
                settingsMenu.classList.remove('active');
                overlay.classList.remove('active');
            });

            // Estado personal
            document.querySelector('.my-status').addEventListener('click', function() {
                const statusText = prompt('¿Qué estás pensando?');
                if (statusText && statusText.trim() !== '') {
                    const statusRef = database.ref('status_updates').push();
                    statusRef.set({
                        userId: currentUser.uid,
                        text: statusText,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    alert('Estado actualizado correctamente');
                }
            });

            // Botones de ajustes
            document.getElementById('editProfileBtn').addEventListener('click', function() {
                const newName = prompt('Nuevo nombre:', profileName.textContent);
                if (newName && newName.trim() !== '') {
                    database.ref('users/' + currentUser.uid).update({
                        name: newName.trim()
                    }).then(() => {
                        updateProfileInfo();
                        alert('Perfil actualizado correctamente');
                    });
                }
            });

            document.getElementById('newGroupBtn').addEventListener('click', function() {
                alert('Funcionalidad de nuevo grupo en desarrollo');
            });

            document.getElementById('linkedDevicesBtn').addEventListener('click', function() {
                alert('Funcionalidad de dispositivos vinculados en desarrollo');
            });

            document.getElementById('privacyBtn').addEventListener('click', function() {
                alert('Configuración de privacidad y seguridad en desarrollo');
            });

            document.getElementById('themeBtn').addEventListener('click', function() {
                alert('Cambio de tema en desarrollo');
            });

            document.getElementById('blockedUsersBtn').addEventListener('click', function() {
                alert('Gestión de usuarios bloqueados en desarrollo');
            });

            // Cerrar sesión
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                    logout();
                }
            });
        });

        // Manejar el evento de antes de descargar la página
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                database.ref('status/' + currentUser.uid).set({
                    state: 'offline',
                    lastChanged: firebase.database.ServerValue.TIMESTAMP
                });
            }
        });

        // Inicializar altura del textarea
        adjustTextareaHeight();
    </script>
</body>
</html>